<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نتيجة الطالب</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- مكتبة Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl">
    <h1 class="text-2xl font-bold mb-4 text-center">نتيجة الطالب</h1>

    <!-- بيانات الطالب -->
    <div class="student-info grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-lg">
      <div class="info-item"><strong>اسم الطالب:</strong> <span id="student-name">-</span></div>
      <div class="info-item"><strong>الصف:</strong> <span id="student-grade">-</span></div>
    </div>

    <!-- المجموع الكلي بشكل بياني -->
    <div class="flex flex-col items-center mb-6">
      <h2 class="text-lg font-semibold mb-2">المجموع الكلي</h2>
      <div class="relative w-48 h-48">
        <canvas id="totalChart"></canvas>
        <div class="absolute inset-0 flex items-center justify-center text-2xl font-bold text-gray-700" id="percentageText">-</div>
      </div>
      <div class="mt-2 text-xl font-bold text-gray-700" id="totalText">-</div>
    </div>

    <!-- جدول المواد -->
    <div class="overflow-x-auto">
      <table class="w-full text-center border border-gray-300 rounded-lg overflow-hidden">
        <thead class="bg-gray-200 text-gray-700">
          <tr>
            <th class="py-2 px-4 border">المادة</th>
            <th class="py-2 px-4 border">الدرجة</th>
            <th class="py-2 px-4 border">الدرجة الكاملة</th>
          </tr>
        </thead>
        <tbody id="subjects-table" class="text-gray-800">
          <!-- يتم ملؤه بالدرجات -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // بيانات تجريبية كأنها جاية من Google Sheets
    const student = {
      name: "أحمد محمد",
      grade: "الرابع",
      subjects: [
        { name: "اللغة العربية", mark: 45, fullMark: 50 },
        { name: "اللغة الإنجليزية", mark: 40, fullMark: 50 },
        { name: "الرياضيات", mark: 48, fullMark: 50 },
        { name: "العلوم", mark: 42, fullMark: 50 },
        { name: "الدراسات الاجتماعية", mark: 44, fullMark: 50 },
        { name: "التربية الدينية", mark: 47, fullMark: 50 }
      ]
    };

    function showResult(student) {
      document.getElementById("student-name").textContent = student.name;
      document.getElementById("student-grade").textContent = student.grade;

      let totalMarks = 0;
      let fullMarks = 0;

      const table = document.getElementById("subjects-table");
      table.innerHTML = ""; // تفريغ الجدول

      student.subjects.forEach(sub => {
        totalMarks += parseInt(sub.mark) || 0;
        fullMarks += parseInt(sub.fullMark) || 0;

        const row = `
          <tr>
            <td class="py-2 px-4 border">${sub.name}</td>
            <td class="py-2 px-4 border">${sub.mark}</td>
            <td class="py-2 px-4 border">${sub.fullMark}</td>
          </tr>
        `;
        table.innerHTML += row;
      });

      // حساب النسبة المئوية
      let percentage = ((totalMarks / fullMarks) * 100).toFixed(1);

      // كتابة المجموع والنسبة
      document.getElementById("totalText").textContent = totalMarks + " / " + fullMarks;
      document.getElementById("percentageText").textContent = percentage + "%";

      // رسم الرسم البياني
      const ctx = document.getElementById("totalChart").getContext("2d");
      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["الدرجات المحققة", "المتبقي"],
          datasets: [{
            data: [totalMarks, fullMarks - totalMarks],
            backgroundColor: ["#4CAF50", "#E5E7EB"], // أخضر + رمادي فاتح
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          cutout: "70%" // يخليها شبه عجلة
        }
      });
    }

    // تشغيل عند الفتح
    showResult(student);
  </script>
</body>
</html>
