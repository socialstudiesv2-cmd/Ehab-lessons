<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام عرض النتائج</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    header {
      text-align: center;
      padding: 15px;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: #fff;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover { opacity: 0.9; }
    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      text-align: center;
      display: none;
    }
    .result {
      display: none;
      margin-top: 20px;
    }
    .result h2 {
      text-align: center;
      color: #2E7D32;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      text-align: center;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
    }
    th {
      background: #2E7D32;
      color: #fff;
    }
    tr:nth-child(even) td { background: #f9f9f9; }
    .total-row {
      background: #e8f5e9;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>نظام عرض النتائج</h1>
      <p>استعلم عن نتيجتك برقم الجلوس</p>
    </header>

    <input type="text" id="seat-number" placeholder="أدخل رقم الجلوس">
    <button onclick="searchResult()">عرض النتيجة</button>
    <div class="error" id="error"></div>

    <div class="result" id="result">
      <h2>النتيجة</h2>
      <div><strong>اسم الطالب:</strong> <span id="student-name"></span></div>
      <div><strong>الصف:</strong> <span id="student-grade"></span></div>
      <div><strong>المدرسة:</strong> <span id="student-school"></span></div>

      <table id="subjects-table"></table>
    </div>
  </div>

  <script>
    async function fetchResults() {
      const sheetID = "YOUR_SHEET_ID"; // ضع ID الشيت هنا
      const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

      const response = await fetch(url);
      const text = await response.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;
      const cols = json.table.cols.map(c => c.label);

      let data = {};

      rows.forEach(row => {
        let seatNumber = row.c[0]?.v;
        if (!seatNumber) return;

        data[seatNumber] = {
          name: row.c[1]?.v || "-",
          grade: row.c[2]?.v || "-",
          school: row.c[3]?.v || "-",
          subjects: {}
        };

        for (let i = 4; i < row.c.length; i++) {
          let subject = cols[i];
          let score = row.c[i]?.v || 0;
          data[seatNumber].subjects[subject] = score;
        }
      });

      return data;
    }

    async function searchResult() {
      const seatNumber = document.getElementById("seat-number").value.trim();
      const errorDiv = document.getElementById("error");
      const resultDiv = document.getElementById("result");
      const table = document.getElementById("subjects-table");

      errorDiv.style.display = "none";
      resultDiv.style.display = "none";
      table.innerHTML = "";

      if (!seatNumber) {
        errorDiv.textContent = "من فضلك أدخل رقم الجلوس";
        errorDiv.style.display = "block";
        return;
      }

      try {
        const data = await fetchResults();

        if (data[seatNumber]) {
          const student = data[seatNumber];
          document.getElementById("student-name").textContent = student.name;
          document.getElementById("student-grade").textContent = student.grade;
          document.getElementById("student-school").textContent = student.school;

          // عناوين المواد
          let headerRow = "<tr>";
          Object.keys(student.subjects).forEach(sub => {
            headerRow += `<th>${sub}</th>`;
          });
          headerRow += "</tr>";
          table.innerHTML += headerRow;

          // صف الدرجات
          let scoreRow = "<tr>";
          Object.values(student.subjects).forEach(score => {
            scoreRow += `<td>${score}</td>`;
          });
          scoreRow += "</tr>";
          table.innerHTML += scoreRow;

          // المجموع الكلي
          let total = Object.values(student.subjects).reduce((sum, s) => sum + Number(s), 0);
          let totalRow = `<tr class="total-row"><td colspan="${Object.keys(student.subjects).length}">المجموع الكلي: ${total}</td></tr>`;
          table.innerHTML += totalRow;

          resultDiv.style.display = "block";
        } else {
          errorDiv.textContent = "رقم الجلوس غير موجود";
          errorDiv.style.display = "block";
        }
      } catch (err) {
        console.error(err);
        errorDiv.textContent = "حدث خطأ أثناء جلب البيانات";
        errorDiv.style.display = "block";
      }
    }
  </script>
</body>
</html>
