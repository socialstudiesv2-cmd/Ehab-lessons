<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام نتائج الطلاب</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl">
    <h1 class="text-2xl font-bold text-center text-blue-600 mb-4">نظام عرض النتائج</h1>

    <!-- إدخال رقم الجلوس -->
    <div class="flex gap-2 mb-4">
      <input id="seatInput" type="text" placeholder="أدخل رقم الجلوس" 
        class="border rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-400">
      <button onclick="loadResult()" 
        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">عرض النتيجة</button>
    </div>

    <!-- مكان عرض النتيجة -->
    <div id="result" class="hidden">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">بيانات الطالب</h2>
      <p><strong>الاسم:</strong> <span id="studentName"></span></p>
      <p><strong>الصف:</strong> <span id="studentGrade"></span></p>
      <p><strong>المدرسة:</strong> <span id="studentSchool"></span></p>

      <!-- جدول الدرجات -->
      <h3 class="text-lg font-semibold text-gray-700 mt-4">الدرجات:</h3>
      <ul id="subjectsList" class="list-disc pr-5 text-gray-600"></ul>

      <!-- رسم بياني دائري -->
      <h3 class="text-lg font-semibold text-gray-700 mt-4">المجموع الكلي:</h3>
      <canvas id="resultChart" class="mt-2"></canvas>
    </div>
  </div>

<script>
  // ضع ID الشيت هنا
  const SHEET_ID = "YOUR_SHEET_ID_HERE";
  const SHEET_NAME = "Sheet1";
  const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

  let resultsData = {};

  // تحميل البيانات من Google Sheets
  async function fetchResults() {
    const response = await fetch(SHEET_URL);
    const text = await response.text();
    const json = JSON.parse(text.substring(47, text.length - 2));

    json.table.rows.forEach(row => {
      const seat = row.c[0]?.v;
      if (seat) {
        resultsData[seat] = {
          name: row.c[1]?.v || "-",
          grade: row.c[2]?.v || "-",
          school: row.c[3]?.v || "-",
          subjects: [
            { name: "اللغة العربية", score: row.c[4]?.v || 0, fullScore: 100 },
            { name: "اللغة الإنجليزية", score: row.c[5]?.v || 0, fullScore: 100 },
            { name: "الرياضيات", score: row.c[6]?.v || 0, fullScore: 100 },
            { name: "العلوم", score: row.c[7]?.v || 0, fullScore: 100 },
            { name: "الدراسات الاجتماعية", score: row.c[8]?.v || 0, fullScore: 100 }
          ]
        };
      }
    });
  }

  async function loadResult() {
    const seatNo = document.getElementById("seatInput").value.trim();
    if (!seatNo) {
      alert("من فضلك أدخل رقم الجلوس");
      return;
    }

    if (Object.keys(resultsData).length === 0) {
      await fetchResults();
    }

    const student = resultsData[seatNo];
    if (!student) {
      alert("رقم الجلوس غير موجود");
      return;
    }

    document.getElementById("studentName").textContent = student.name;
    document.getElementById("studentGrade").textContent = student.grade;
    document.getElementById("studentSchool").textContent = student.school;

    const subjectsList = document.getElementById("subjectsList");
    subjectsList.innerHTML = "";
    student.subjects.forEach(sub => {
      const li = document.createElement("li");
      li.textContent = `${sub.name}: ${sub.score}/${sub.fullScore}`;
      subjectsList.appendChild(li);
    });

    // الرسم البياني
    const ctx = document.getElementById("resultChart").getContext("2d");
    new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: student.subjects.map(s => s.name),
        datasets: [{
          data: student.subjects.map(s => s.score),
          backgroundColor: ["#3498db","#2ecc71","#f1c40f","#e67e22","#9b59b6"]
        }]
      }
    });

    document.getElementById("result").classList.remove("hidden");
  }
</script>
</body>
</html>
